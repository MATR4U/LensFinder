#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

set -e

# Collect staged TS/TSX files under client/src
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACMRTUXB | grep -E '^client/src/.*\.(ts|tsx)$' || true)

if [ -z "$STAGED_FILES" ]; then
  echo "[pre-commit] No client TS/TSX files staged. Skipping ESLint."
  exit 0
fi

ABS_ARGS=""
for file in $STAGED_FILES; do
  ABS_ARGS="$ABS_ARGS $(pwd)/$file"
done

echo "[pre-commit] Linting changed files with ESLint (quiet):"
echo "$STAGED_FILES" | sed 's/^/ - /'

# Run ESLint via the client workspace on only the staged files
npm --workspace client exec -- eslint --quiet $ABS_ARGS

echo "[pre-commit] ESLint passed."

